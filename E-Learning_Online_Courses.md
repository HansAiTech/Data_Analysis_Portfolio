
<a name="Inicio"></a>    
# Data Cleaning - E-Learning Online Courses [![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2) ([ES](https://github.com/HansAllTech/Hans_Data_Analysis_Portfolio/blob/main/E-Learning_Cursos_Online.md#limpieza-de-datos---e-learning-cursos-online--es--en) | [EN](https://github.com/HansAllTech/Hans_Data_Analysis_Portfolio/blob/main/E-Learning_Cursos_Online.md#limpieza-de-datos---e-learning-cursos-online--es--en))
  
<p align = 'center'><img src="https://user-images.githubusercontent.com/116538899/235765262-8acfe1d1-a637-4ef7-adeb-b1880368c671.jpg" width ="25%"></p>
  
  
  
<a name="Tabla-de-contenido2"></a>
## Table of Content [![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2)
- [Business Problem](#Problema)
- [Objective](#Objetivo2)  
- [Client](#Cliente2)
- [Diagram](#Diagrama2)
- [Preliminary Analysis](#An치lisis-Previo2)
- [Execution](#Ejecuci칩n2)   
- [Conclusions](#Conclusiones2) 
- [Recommendations](#Recomendaciones2) 

<a name="Problema"></a>    
## Business Problem [![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2)
<p align='justify'>
LearnData's business problem is that it currently lacks an established system to capture, analyze, and make decisions based on its key financial metrics. Without an effective system in place, the company cannot identify areas that need improvement or make informed decisions that drive business growth. Additionally, without an adequate data capture process, the raw data generated by the business's website could be incomplete, inaccurate, or contain duplicates, further complicating analysis and decision-making.
</p>  
  
<a name="Objetivo2"></a>
## Objective[![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2)
<p align='justify'>
Perform a data cleaning process to ensure that the raw data related to customers, payments, orders, and products are complete, accurate, and do not contain duplicates, which will allow for greater accuracy in analysis and more informed decision-making regarding customer and sales management. In addition, the company should invest in the development and implementation of a system that can efficiently and effectively capture and analyze this data so that the company can make data-driven decisions to improve its performance in terms of customer and sales management.
</p>  

<a name="Cliente2"></a>
## Client[![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2)  
[LearnData] is an e-learning company dedicated to selling online data analysis courses. Its main objective is:
- Start building a technological infrastructure to analyze their data.   
- Clean the data so that it can be consumed by the business areas..  

Uses the following tools to manage their business: 


 |<img src="https://user-images.githubusercontent.com/116538899/236007188-b5128f0e-6b47-4a4e-9460-83e86b808f16.png"> |<p align="center"><img src="https://user-images.githubusercontent.com/116538899/236010475-907ed43b-509f-49a3-8bb4-d0d0642afcba.png" width ='40%'></p> | <img src="https://user-images.githubusercontent.com/116538899/236007568-44196c1a-938c-4216-9e6d-94e6be903f7b.png"> |
| :------------------------------------------------| :-------------------------------------------------| :------------------------------------------------ |
| Wocommerce: It is a WordPress plugin that allows you to turn your website into an e-commerce site and sell products.   | Wordpress: It is a content management system (CMS), a software used to build, modify and maintain websites. It is the most popular CMS on the market, used by 65.2% of the websites whose CMS we know. This translates into 42.4% of all websites, almost half of the Internet. | Stripe: It is an online payment processing platform, just like PayPal. |



<a name="Diagrama2"></a>
## Diagram [![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2)
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235769297-9446a0b7-0ce3-47b4-b7dd-0b3eac8e6c61.png" width= 60% height=60%>
</p>    

 
 
<a name="An치lisis-Previo2"></a>
## Preliminary Analysis [![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2)
1. What data sources does the company have?
   <p align='justify'>The company uses WordPress with a WooCommerce plugin as a platform to sell its online courses, and then it has Stripe as a payment gateway in addition to credit card payments.</p>
2. In what format are the data downloaded?   
   <p align='justify'> We will have the raw data in CSV format directly downloaded from the sources.</p>
3. What data do we have   
   <p align='justify'>We have data on the products, meaning the courses that are sold, the customers, the orders, and the payments received through Stripe.</p>
4. Data model
   <p align='justify'>We have the orders table which relates to the customers and products table through SKU_product and customer_id, and on the other hand, we have the Stripe payments table which we will relate to the orders table by the order number.</p><br>   
5. Exploratory analysis of the tables.  

**Analyzing raw tables**  

- _Tabla raw_productos_wocommerce_
   
```sql
SELECT * FROM learndata_crudo.raw_productos_wocommerce;
```  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235800904-2d0afb4d-8c31-4586-9ecf-fe50f5564ba2.png">
</p>  

- _Tabla raw_clientes_wocommerce_
   
```sql
SELECT * FROM learndata_crudo.raw_clientes_wocommerce;	
```  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235801625-babcec77-b88a-48b0-9a05-5fb1407a2b2e.png">
</p>  

- _Tabla raw_clientes_wocommerce_
   
```sql
SELECT * FROM learndata_crudo.raw_pagos_stripe;	
```  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235801722-45eceaad-da39-4341-b013-dd0ae6fe5793.png">
</p>   

- _Tabla raw_pedidos_wocommerce_
   
```sql
SELECT * FROM learndata_crudo.raw_pedidos_wocommerce;;	
```  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235801953-7c78dfa1-5b5e-4e44-a406-f1bc255a0105.png">
</p>    


<a name="Ejecuci칩n2"></a>    
## Execution [![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2)  
1. Create a new MYSQL database called "learndata" + tables:
    1. dim_clientes; dim_producto;fac_pedidos; fac_pagos_stripe

```sql
# Creating a database
CREATE SCHEMA learndata;

# Creation of dim_clientes table
CREATE TABLE dim_clientes (
    id_cliente INT,
    fecha_creacion_cliente DATE,
    nombre_cliente VARCHAR(100),
    apellido_cliente VARCHAR(100),
    email_cliente VARCHAR(100),
    telefono_cliente VARCHAR(100),
    region_cliente VARCHAR(100),
    pais_cliente VARCHAR(100),
    codigo_postal_cliente VARCHAR(100),
    direccion_cliente VARCHAR(255),
    PRIMARY KEY (id_cliente)
    );
    
# Creation of dim_product table
CREATE TABLE dim_producto (
    id_producto INT,
    sku_producto INT,
    nombre_producto VARCHAR(200),
    publicado_producto BOOLEAN,
    inventario_producto VARCHAR(100),
    precio_normal_producto INT,
    categoria_producto VARCHAR(100),
    PRIMARY KEY (sku_producto)
    );

# Creation of fac_pedidos table
CREATE TABLE fac_pedidos (
    id_pedido INT,
    sku_producto INT,
    estado_pedido VARCHAR(50),
    fecha_pedido DATE,
    id_cliente INT,
    tipo_pago_pedido VARCHAR(50),
    coto_pedido INT,
    importe_de_descuento_pedido DECIMAL(10,0),
    importe_total_pedido INT,
    cantidad_pedido INT,
    codigo_cupon_pedido VARCHAR(100),
    PRIMARY KEY (id_pedido),
    FOREIGN KEY (id_cliente) REFERENCES dim_clientes (id_cliente),
    FOREIGN KEY (sku_producto) REFERENCES dim_producto (sku_producto)
    );
    
# Creation of fac_pagos_stripe table
CREATE TABLE fac_pagos_stripe (
    id_pago INT,
    fecha_pago DATETIME(6),
    id_pedido INT,
    importe_pago INT,
    moneda_pago VARCHAR(5),
    comision_pago DECIMAL(10,2),
    neto_pago DECIMAL(10,2),
    tipo_pago VARCHAR(50),
    PRIMARY KEY (id_pago),
    FOREIGN KEY (id_pedido) REFERENCES fac_pedidos (id_pedido)
    ) 
```
**New Diagram**  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235796810-2720600f-c6eb-4597-919b-d5baae753d21.png" width= 60% height=60%>
</p>    

 
2. Create the products table from the raw data.
    1. Check how the data comes
    2. Rename the field names
    3. Insert the fields into the new table

**Inserting values into dim_product table.**     
```sql
INSERT INTO learndata.dim_producto
SELECT
id AS id_producto,
sku AS sku_producto,
nombre AS nombre_producto, 
publicado AS publicado_producto,
inventario AS inventario_producto,
precio_normal AS precio_normal_producto,
categorias AS categoria_producto
FROM learndata_crudo.raw_productos_wocommerce;
```  

<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235800584-99aaefbe-74fe-4ed8-b4fe-c845153d8236.png">
</p>    



3. Create the customers table from the raw data:
    1. Check how the data comes
    2. Rename the field names
    3. Convert the date_created field, which comes as a timestamp, to date only
    4. Extract from the billing field all the customer descriptors we need by learning to parse a JSON. 
    5. Insert the fields into the new table  

**Inserting values into dim_clientes table**     
```sql
INSERT INTO learndata.dim_clientes
SELECT 
id AS id_cliente,
STR_TO_DATE(date_created, '%d/%m/%Y %H:%i:%s' ) AS fecha_creacion_cliente,
JSON_VALUE(billing,'$[0].first_name') AS nombre_cliente, 
JSON_VALUE(billing,'$[0].last_name') AS apellido_cliente,
JSON_VALUE(billing,'$[0].email') AS email_cliente,
JSON_VALUE(billing,'$[0].phone') AS telefono_cliente,
JSON_VALUE(billing,'$[0].Region') AS region_cliente,
JSON_VALUE(billing,'$[0].country') AS pais_cliente,
JSON_VALUE(billing,'$[0].postcode') AS codigo_postal_cliente,
JSON_VALUE(billing,'$[0].address_1') AS direccion_cliente
FROM learndata_crudo.raw_clientes_wocommerce;
```  

<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235809344-4feb0b46-a0cb-4873-b091-9b43d1d6691e.png">
</p>    


4. Create the orders table from raw data
    1. Check how the data comes
    2. Rename the fields
    3. Substitute the product name by its ID
    4. Normalize the payment method column
    5. Convert the order date column to date format
    6. Round the decimals of the item cost column to integers
    7. Insert the orders into the table.
  


```sql
# Sku errors
SELECT
DISTINCT sku
FROM learndata_crudo.raw_pedidos_wocommerce;
```  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235987844-4958b12c-2299-459f-8bdb-02afe4ab2b31.png">
</p>    


```sql
# Different payment methods.
SELECT
DISTINCT titulo_metodo_de_pago
FROM learndata_crudo.raw_pedidos_wocommerce;
```  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235988179-dbeb3595-81c4-4c00-a589-3338ff95632c.png">
</p>  


```sql
# Double order number error
SELECT 
* 
FROM learndata_crudo.raw_pedidos_wocommerce
WHERE numero_de_pedido = '41624';
```  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235988377-614255cb-ed68-4dd7-8933-d3fbd55332f6.png">
</p>  


```sql
# We remove the duplicate
DELETE
FROM learndata_crudo.raw_pedidos_wocommerce
WHERE numero_de_pedido = '41624' AND `id cliente` = '1324';
```  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235988887-71d33256-e2ef-4965-ae93-8eb5469f5eb0.png">
</p>   



**Inserting values into fac_orders table**   
```sql
INSERT INTO learndata.fac_pedidos
SELECT
numero_de_pedido AS id_pedido,
CASE WHEN dp.sku_producto IS NULL THEN 3 ELSE dp.sku_producto END AS sku_producto,
estado_de_pedido AS estado_pedido,
DATE(fecha_de_pedido) AS fecha_pedido,
`id cliente` AS id_cliente,
CASE WHEN titulo_metodo_de_pago LIKE '%Stripe%' THEN 'Stripe' ELSE 'Tarjeta' END AS tipo_pago_pedido,
coste_articulo AS costo_pedido,
importe_de_descuento_del_carrito AS importe_de_descuento_pedido,
importe_total_pedido AS importe_total_pedido,
cantidad AS cantidad_pedido,
cupon_articulo AS codigo_cupon_pedido
FROM learndata_crudo.raw_pedidos_wocommerce rpe
LEFT JOIN learndata.dim_producto dp ON  dp.nombre_producto = rpe.nombre_del_articulo;
```  

<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235835155-f07199cb-75b7-45e3-911b-f075b72c8ca1.png">
</p>    

<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/235990366-400885b1-03c5-4bcd-9ae8-884a7fe9478e.png">
</p>  

Note:  
```sql  
# If you are unable to insert values due to date format, use the following configuration before inserting.
SET @@SESSION.sql_mode='ALLOW_INVALID_DATES';
```  
  
5. Create the stripe payments table from the raw data:
    1. Check how the data is structured.
    2. Rename the columns as needed.
    3. Get the order number using the RIGHT function. Remove the order number from the description, as this will allow us to join this table with others.
    4. Convert the "created" field to a timestamp.
    5. Replace commas with dots.
    6. Convert the number to a decimal with two decimal places.
    7. Insert the table into the new database.      

**Inserting values into fac_pedidos table**   
```sql
SET @@SESSION.sql_mode='ALLOW_INVALID_DATES';
INSERT INTO learndata.fac_pagos_stripe (fecha_pago,id_pedido,importe_pago,moneda_pago,comision_pago,neto_pago,tipo_pago)
SELECT
TIMESTAMP(created) AS fecha_pago,
RIGHT(description,5) AS id_pedido,
amount AS importe_pago,
currency AS moneda_pago,
CAST(REPLACE (fee,',','.') AS DECIMAL(10,2)) AS comision_pago,
CAST(REPLACE (net,',','.') AS DECIMAL (10,2)) AS neto_pago,
type AS tipo_pago
FROM learndata_crudo.raw_pagos_stripe;
```  

<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/236005853-7ecbc34b-8cff-463c-bcb6-23e5f04b6d42.png">
</p>    
  
<p align="center">
<img src="https://user-images.githubusercontent.com/116538899/236006162-97a54338-2448-4c08-aada-3a6323af2bb8.png">
</p>
  
<a name="Conclusiones2"></a>
## Conclusions[![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2)  
<p align="justify">  
1. During the analysis, it can be observed that there are different types of SKUs for the same type of product, which in this case is the Power BI course. This could be due to a bad extraction of information from the source.
<br><br>
2. It can be observed that there are different types of payment methods and unnecessary additional information about the cards is being provided, which could represent a risk to the protection of user data.
<br><br>
3. It was observed that there is a duplicate in the order number 41624, which is an unacceptable error as it could be considered as a fraudulent sale.
</p>
  
<a name="Recomendaciones2"></a>
## Recommendations[![Texto](https://user-images.githubusercontent.com/116538899/231064143-c080de13-8be9-4321-8694-e62539263f5a.png)](#Tabla-de-contenido2)  
<p align="justify"> 
1. It is recommended to discuss with the information gathering team to determine the incorrect extraction of the source of origin regarding the variation of SKUs for the same Power BI course, and thus find an appropriate solution.
<br><br>  
2. It is recommended to filter all payment methods to only obtain results for card and cash payments, in order to expedite the analysis and safeguard the protection of customer data.
<br><br> 
3. It is recommended to inform the data extraction team and the finance department about the existence of two orders with the same number (41624). It is necessary to determine if it is an error in the sales process or a possible fraudulent sale. Therefore, caution should be exercised, and a detailed investigation is recommended to resolve this issue and avoid future inconsistencies.
</p>
